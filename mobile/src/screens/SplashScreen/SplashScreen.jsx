import React, { useEffect, useState } from "react";
import { useSteps } from "../../CustomHooks.jsx/useSteps";
import { useNavigation } from "@react-navigation/native";
import { authSetUser } from "../../Redux/ReducerAuth";
import { useDispatch } from "react-redux";
import { realodadUser } from "../../../auth/authPeticiones";
import AsyncStorage from "@react-native-async-storage/async-storage";
import { setClientes, setProfesiones, setServicios } from "../../Redux/ReducerProfesion";
import { setMyHorse } from "../../Redux/ReducerHorse";
import { View } from "react-native-animatable";
import { Svg, Path } from "react-native-svg";


export const SplashScreen = () => {
  const { steps, setSteps, imgSource, setImgSource } = useSteps()
  const [hasToken, setHasToken] = useState('loading')
  const [showSplash, setShowSplash] = useState(true);
  const [splash, setSplash] = useState(false)
  const navigation = useNavigation()

  const dispatch = useDispatch()
  useEffect(() => {
    const refreshToken = async () => {
      try {
        let token = await AsyncStorage.getItem("token");

        await realodadUser({
          token,
          succes: async (v) => {
            dispatch(authSetUser(v.user),
              dispatch(setProfesiones(v.profesiones),
                dispatch(setMyHorse(v.userHorses)),
                dispatch(setServicios(v.profesiones.servicios),
                  dispatch(setClientes(v.profesiones.clientes)))));
                  if (v.user.code === "sin Verificar" || v.user.code !== "verificado") {
                    navigation.navigate("Login", {"verificar": "verificar"})

                  }else{
                    navigation.navigate("ScreenEvent");

                  }

            // navigation.navigate("Federacion");
          },
          error: (e) =>navigation.navigate("WelcomeScreen")
          ,
          loading: (l) => setSplash(true)
        });
      } catch (error) {
        navigation.navigate("WelcomeScreen")
      }
    };
refreshToken()
  }, []);


  // lo desactive por el bug que volvia al welcome screen por mas que estuviera logueado
  // useEffect(() => {
  //   const temporizador = setTimeout(() => {
  //     navigation.navigate("WelcomeScreen")
  //   }, 4000);

  //   // Limpieza del temporizador
  //   return () => clearTimeout(temporizador);
  // }, [])
  useEffect(() => {
    if (steps === 0) {
      setImgSource(require('../../images/welcome11.png'))
    } else if (steps === 1) {
      setImgSource(require('../../images/welcome212.png'))
    } else if (steps === 2) {
      setImgSource(require('../../images/welcome31.png'))
    } else if (steps === 3) {
      setImgSource(require('../../images/welcome41.png'))
    }
  }, [steps])

  const finishStep = () => {
    navigation.navigate("AuthScreen")
  }
    return (
        <View className="h-full w-full bg-[#23254C] flex justify-center items-center">
            <View className="flex flex-row items-center gap-2">
                <Svg width="195" height="68" viewBox="0 0 195 68" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <Path d="M83.8156 23.0643L76.0833 18.6036V23.0643V36.882H53.4328V23.0643V14.3792V5.52434L44.1348 0.155273V67.2575H44.6H53.4328V45.5154H76.0833V67.2575H86.6885V24.726L83.8156 23.0643Z" fill="white" />
                    <Path d="M33.2557 5.33214V14.3791V23.0641V36.8819H10.6052V23.0641V18.3302L2.35589 23.0641L0 24.4156V67.2573H10.6052V45.5152H33.2557V67.2573H42.0885H42.5537V0L33.2557 5.33214Z" fill="white" />
                    <Path d="M111.595 0.0810547V3.51466H106.938V17.6751H102.657V3.51466H98V0.0810547H111.595Z" fill="white" />
                    <Path d="M128.967 0.0810547V17.6751H124.686V10.432H118.026V17.6751H113.744V0.0810547H118.026V6.97332H124.686V0.0810547H128.967Z" fill="white" />
                    <Path d="M136.339 3.51466V7.07357H142.073V10.3819H136.339V14.2415H142.824V17.6751H132.058V0.0810547H142.824V3.51466H136.339Z" fill="white" />
                    <Path d="M114.174 24.6963V42.2904H109.893V35.0472H103.233V42.2904H98.9514V24.6963H103.233V31.5886H109.893V24.6963H114.174Z" fill="white" />
                    <Path d="M125.578 42.4658C123.925 42.4658 122.406 42.0815 121.021 41.3129C119.652 40.5443 118.559 39.475 117.741 38.1049C116.94 36.7181 116.539 35.1642 116.539 33.4432C116.539 31.7222 116.94 30.1767 117.741 28.8066C118.559 27.4365 119.652 26.3671 121.021 25.5986C122.406 24.83 123.925 24.4457 125.578 24.4457C127.23 24.4457 128.741 24.83 130.109 25.5986C131.495 26.3671 132.58 27.4365 133.364 28.8066C134.165 30.1767 134.566 31.7222 134.566 33.4432C134.566 35.1642 134.165 36.7181 133.364 38.1049C132.563 39.475 131.478 40.5443 130.109 41.3129C128.741 42.0815 127.23 42.4658 125.578 42.4658ZM125.578 38.556C126.98 38.556 128.098 38.0882 128.933 37.1525C129.784 36.2168 130.21 34.9804 130.21 33.4432C130.21 31.8893 129.784 30.6529 128.933 29.7339C128.098 28.7982 126.98 28.3304 125.578 28.3304C124.159 28.3304 123.024 28.7899 122.172 29.7089C121.338 30.6278 120.921 31.8726 120.921 33.4432C120.921 34.9971 121.338 36.2419 122.172 37.1776C123.024 38.0965 124.159 38.556 125.578 38.556Z" fill="white" />
                    <Path d="M145.911 42.2904L142.256 35.6487H141.229V42.2904H136.948V24.6963H144.134C145.519 24.6963 146.696 24.9386 147.664 25.4231C148.649 25.9077 149.383 26.576 149.867 27.4281C150.351 28.2636 150.593 29.1992 150.593 30.2352C150.593 31.4048 150.26 32.4491 149.592 33.368C148.941 34.287 147.973 34.9386 146.688 35.3229L150.744 42.2904H145.911ZM141.229 32.6161H143.883C144.668 32.6161 145.252 32.424 145.636 32.0397C146.037 31.6554 146.237 31.1124 146.237 30.4106C146.237 29.7423 146.037 29.216 145.636 28.8317C145.252 28.4474 144.668 28.2552 143.883 28.2552H141.229V32.6161Z" fill="white" />
                    <Path d="M159.641 42.4658C158.355 42.4658 157.204 42.257 156.185 41.8392C155.167 41.4215 154.349 40.8033 153.732 39.9846C153.131 39.1659 152.814 38.1801 152.78 37.0272H157.337C157.404 37.6788 157.629 38.1801 158.013 38.531C158.397 38.8651 158.898 39.0322 159.515 39.0322C160.15 39.0322 160.65 38.8902 161.018 38.6061C161.385 38.3054 161.569 37.896 161.569 37.3781C161.569 36.9436 161.418 36.5844 161.118 36.3004C160.834 36.0163 160.475 35.7824 160.041 35.5986C159.624 35.4148 159.023 35.206 158.239 34.972C157.103 34.6212 156.177 34.2703 155.459 33.9194C154.742 33.5685 154.124 33.0506 153.607 32.3655C153.089 31.6805 152.83 30.7866 152.83 29.6838C152.83 28.0464 153.423 26.7682 154.608 25.8492C155.793 24.9135 157.337 24.4457 159.24 24.4457C161.176 24.4457 162.737 24.9135 163.922 25.8492C165.107 26.7682 165.741 28.0547 165.825 29.7089H161.193C161.16 29.1408 160.951 28.698 160.567 28.3805C160.183 28.0464 159.691 27.8793 159.09 27.8793C158.572 27.8793 158.155 28.0213 157.838 28.3053C157.521 28.5727 157.362 28.9653 157.362 29.4833C157.362 30.0514 157.629 30.4942 158.163 30.8116C158.698 31.1291 159.532 31.4716 160.667 31.8392C161.802 32.2235 162.72 32.5911 163.421 32.942C164.139 33.2928 164.757 33.8024 165.274 34.4708C165.792 35.1391 166.05 35.9996 166.05 37.0523C166.05 38.0548 165.792 38.9654 165.274 39.7841C164.773 40.6028 164.039 41.2544 163.071 41.739C162.103 42.2235 160.959 42.4658 159.641 42.4658Z" fill="white" />
                    <Path d="M172.967 28.1299V31.6888H178.7V34.9971H172.967V38.8568H179.451V42.2904H168.685V24.6963H179.451V28.1299H172.967Z" fill="white" />
                    <Path d="M188.59 42.4658C187.305 42.4658 186.153 42.257 185.135 41.8392C184.117 41.4215 183.299 40.8033 182.681 39.9846C182.081 39.1659 181.763 38.1801 181.73 37.0272H186.287C186.354 37.6788 186.579 38.1801 186.963 38.531C187.347 38.8651 187.848 39.0322 188.465 39.0322C189.099 39.0322 189.6 38.8902 189.967 38.6061C190.335 38.3054 190.518 37.896 190.518 37.3781C190.518 36.9436 190.368 36.5844 190.068 36.3004C189.784 36.0163 189.425 35.7824 188.991 35.5986C188.574 35.4148 187.973 35.206 187.188 34.972C186.053 34.6212 185.127 34.2703 184.409 33.9194C183.691 33.5685 183.074 33.0506 182.556 32.3655C182.039 31.6805 181.78 30.7866 181.78 29.6838C181.78 28.0464 182.373 26.7682 183.558 25.8492C184.743 24.9135 186.287 24.4457 188.19 24.4457C190.126 24.4457 191.687 24.9135 192.872 25.8492C194.057 26.7682 194.691 28.0547 194.775 29.7089H190.143C190.109 29.1408 189.901 28.698 189.517 28.3805C189.133 28.0464 188.64 27.8793 188.04 27.8793C187.522 27.8793 187.105 28.0213 186.788 28.3053C186.471 28.5727 186.312 28.9653 186.312 29.4833C186.312 30.0514 186.579 30.4942 187.113 30.8116C187.647 31.1291 188.482 31.4716 189.617 31.8392C190.752 32.2235 191.67 32.5911 192.371 32.942C193.089 33.2928 193.706 33.8024 194.224 34.4708C194.741 35.1391 195 35.9996 195 37.0523C195 38.0548 194.741 38.9654 194.224 39.7841C193.723 40.6028 192.989 41.2544 192.021 41.739C191.052 42.2235 189.909 42.4658 188.59 42.4658Z" fill="white" />
                    <Path d="M114.174 49.3115V66.9056H109.893V59.6625H103.233V66.9056H98.9514V49.3115H103.233V56.2038H109.893V49.3115H114.174Z" fill="white" />
                    <Path d="M125.578 67.0811C123.925 67.0811 122.406 66.6968 121.021 65.9282C119.652 65.1596 118.559 64.0902 117.741 62.7201C116.94 61.3333 116.539 59.7794 116.539 58.0585C116.539 56.3375 116.94 54.7919 117.741 53.4218C118.559 52.0517 119.652 50.9824 121.021 50.2138C122.406 49.4452 123.925 49.0609 125.578 49.0609C127.23 49.0609 128.741 49.4452 130.109 50.2138C131.495 50.9824 132.58 52.0517 133.364 53.4218C134.165 54.7919 134.566 56.3375 134.566 58.0585C134.566 59.7794 134.165 61.3333 133.364 62.7201C132.563 64.0902 131.478 65.1596 130.109 65.9282C128.741 66.6968 127.23 67.0811 125.578 67.0811ZM125.578 63.1713C126.98 63.1713 128.098 62.7034 128.933 61.7677C129.784 60.8321 130.21 59.5956 130.21 58.0585C130.21 56.5046 129.784 55.2681 128.933 54.3492C128.098 53.4135 126.98 52.9456 125.578 52.9456C124.159 52.9456 123.024 53.4051 122.172 54.3241C121.338 55.2431 120.921 56.4879 120.921 58.0585C120.921 59.6123 121.338 60.8571 122.172 61.7928C123.024 62.7118 124.159 63.1713 125.578 63.1713Z" fill="white" />
                    <Path d="M141.154 49.3115V59.8379C141.154 60.8905 141.413 61.7009 141.93 62.269C142.448 62.8371 143.207 63.1211 144.209 63.1211C145.21 63.1211 145.978 62.8371 146.512 62.269C147.046 61.7009 147.314 60.8905 147.314 59.8379V49.3115H151.595V59.8129C151.595 61.3835 151.261 62.7118 150.593 63.7978C149.926 64.8839 149.024 65.7026 147.889 66.254C146.771 66.8054 145.519 67.0811 144.134 67.0811C142.748 67.0811 141.505 66.8137 140.403 66.2791C139.318 65.7277 138.459 64.909 137.824 63.8229C137.19 62.7201 136.873 61.3835 136.873 59.8129V49.3115H141.154Z" fill="white" />
                    <Path d="M160.961 67.0811C159.676 67.0811 158.524 66.8722 157.506 66.4545C156.488 66.0368 155.67 65.4186 155.052 64.5998C154.451 63.7811 154.134 62.7953 154.101 61.6424H158.658C158.724 62.2941 158.95 62.7953 159.334 63.1462C159.717 63.4804 160.218 63.6475 160.836 63.6475C161.47 63.6475 161.971 63.5054 162.338 63.2214C162.705 62.9206 162.889 62.5113 162.889 61.9933C162.889 61.5589 162.739 61.1997 162.438 60.9156C162.154 60.6316 161.796 60.3976 161.362 60.2139C160.944 60.0301 160.343 59.8212 159.559 59.5873C158.424 59.2364 157.497 58.8855 156.78 58.5346C156.062 58.1838 155.444 57.6658 154.927 56.9808C154.409 56.2957 154.151 55.4018 154.151 54.299C154.151 52.6616 154.743 51.3834 155.928 50.4644C157.114 49.5288 158.658 49.0609 160.56 49.0609C162.497 49.0609 164.057 49.5288 165.242 50.4644C166.428 51.3834 167.062 52.67 167.145 54.3241H162.513C162.48 53.756 162.271 53.3132 161.887 52.9958C161.503 52.6616 161.011 52.4945 160.41 52.4945C159.893 52.4945 159.475 52.6365 159.158 52.9206C158.841 53.1879 158.683 53.5806 158.683 54.0985C158.683 54.6666 158.95 55.1094 159.484 55.4269C160.018 55.7443 160.852 56.0868 161.988 56.4544C163.123 56.8387 164.041 57.2063 164.742 57.5572C165.459 57.9081 166.077 58.4177 166.594 59.086C167.112 59.7544 167.371 60.6149 167.371 61.6675C167.371 62.67 167.112 63.5806 166.594 64.3993C166.094 65.2181 165.359 65.8697 164.391 66.3542C163.423 66.8388 162.28 67.0811 160.961 67.0811Z" fill="white" />
                    <Path d="M174.287 52.7451V56.3041H180.02V59.6123H174.287V63.472H180.772V66.9056H170.005V49.3115H180.772V52.7451H174.287Z" fill="white" />
                </Svg>
            </View>
        </View>
    )
}